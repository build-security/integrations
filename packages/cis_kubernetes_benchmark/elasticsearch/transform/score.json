{
    "source": {
        "index": [
            ".csp-latest-findings*"
        ]
    },
    "pivot": {
        "group_by": {
            "rule.benchmark": {
                "terms": {
                    "field": "rule.benchmark.keyword"
                }
            },
            "agent.id": {
                "terms": {
                    "field": "agent.id.keyword"
                }
            }
        },
        "aggregations": {
            "passed": {
                "filter": {
                    "term": {
                        "result.evaluation.keyword": "passed"
                    }
                },
                "aggs": {
                    "passed_counter": {
                        "value_count": {
                            "field": "result.evaluation.keyword"
                        }
                    }
                }
            },
            "total_findings": {
                "value_count": {
                    "field": "result.evaluation.keyword"
                }
            },
            "score": {
                "bucket_script": {
                    "buckets_path": {
                        "passed": "passed\u003epassed_counter",
                        "total": "total_findings"
                    },
                    "script": "params.passed / params.total"
                }
            }
        }
    },
    "frequency": "1m",
    "dest": {
        "index": ".csp-score"
    },
    "sync": {
        "time": {
            "field": "@timestamp",
            "delay": "60s"
        }
    },
    "settings": {
        "max_page_search_size": 500
    }
}